<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FormDataæµ‹è¯•</title>
</head>
<body>
    <h1>FormData APIæµ‹è¯•</h1>
    <form id="testForm">
        <div>
            <label>æè¿°è¯:</label>
            <input type="text" id="prompt" value="beautiful woman, anime figure" />
        </div>
        <div>
            <label>æœåŠ¡:</label>
            <select id="service">
                <option value="grsai">Grsai</option>
                <option value="stability">Stability AI</option>
            </select>
        </div>
        <div>
            <label>é€‰é¡¹:</label>
            <input type="text" id="options" value='{"style":"anime","pose":"standing"}' />
        </div>
        <div>
            <label>å›¾ç‰‡æ–‡ä»¶:</label>
            <input type="file" id="imageFile" accept="image/*" />
        </div>
        <button type="button" onclick="testAPI()">æµ‹è¯•APIè°ƒç”¨</button>
    </form>
    
    <div id="result"></div>

    <script>
        async function testAPI() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = 'ğŸ”„ æ­£åœ¨æµ‹è¯•...';
            
            try {
                // åˆ›å»ºFormData
                const formData = new FormData();
                formData.append('prompt', document.getElementById('prompt').value);
                formData.append('service', document.getElementById('service').value);
                formData.append('options', document.getElementById('options').value);
                
                const imageFile = document.getElementById('imageFile').files[0];
                if (imageFile) {
                    formData.append('file', imageFile);
                    console.log('ğŸ“¸ æ·»åŠ å›¾ç‰‡æ–‡ä»¶:', imageFile.name, imageFile.size, 'bytes');
                }
                
                console.log('ğŸ“¤ å‘é€FormDataè¯·æ±‚...');
                
                // è°ƒç”¨API - ä¸è®¾ç½®Content-Typeå¤´
                const response = await fetch('/api/generate/image', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer demo-key',
                        // æ³¨æ„ï¼šä¸è®¾ç½®Content-Typeï¼Œè®©æµè§ˆå™¨è‡ªåŠ¨è®¾ç½®
                    },
                    body: formData
                });
                
                console.log('ğŸ“¡ å“åº”çŠ¶æ€:', response.status);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('âŒ APIé”™è¯¯:', response.status, errorText);
                    resultDiv.innerHTML = `âŒ é”™è¯¯ ${response.status}: ${errorText}`;
                    return;
                }
                
                const result = await response.json();
                console.log('âœ… APIæˆåŠŸ:', result);
                
                resultDiv.innerHTML = `
                    <h3>âœ… æµ‹è¯•æˆåŠŸï¼</h3>
                    <p><strong>å›¾ç‰‡URL:</strong> <a href="${result.url}" target="_blank">${result.url}</a></p>
                    <p><strong>æç¤ºè¯:</strong> ${result.prompt}</p>
                    <p><strong>æœåŠ¡:</strong> ${result.service}</p>
                    <p><strong>æ–‡ä»¶å:</strong> ${result.name}</p>
                    <p><strong>æ–‡ä»¶å¤§å°:</strong> ${result.size} bytes</p>
                    <p><strong>è¯·æ±‚ID:</strong> ${result.id}</p>
                `;
                
            } catch (error) {
                console.error('âŒ æµ‹è¯•å¤±è´¥:', error);
                resultDiv.innerHTML = `âŒ æµ‹è¯•å¤±è´¥: ${error.message}`;
            }
        }
    </script>
</body>
</html>


