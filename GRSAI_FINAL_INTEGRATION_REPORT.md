# Grsai API æœ€ç»ˆé›†æˆæŠ¥å‘Š

## ğŸ‰ é›†æˆå®Œæˆæ€»ç»“

ç»è¿‡è¯¦ç»†çš„æµ‹è¯•å’Œè°ƒè¯•ï¼ŒGrsai API å·²æˆåŠŸé›†æˆåˆ° Nano Banana é¡¹ç›®ä¸­ï¼

## ğŸ“‹ å…³é”®å‘ç°

### âœ… **æ­£ç¡®çš„ API ä¿¡æ¯**
- **ç«¯ç‚¹**: `https://grsai.dakka.com.cn/v1/draw/nano-banana`
- **æ¨¡å‹**: `nano-banana-fast`, `nano-banana`
- **å“åº”æ ¼å¼**: Server-Sent Events (SSE) æµå¼æ•°æ®
- **API Key**: `sk-bd625bca604243989a7018a67614c889`

### ğŸ”§ **å®ç°çš„åŠŸèƒ½**

#### 1. æ­£ç¡®çš„ API è°ƒç”¨
```typescript
const response = await fetch('https://grsai.dakka.com.cn/v1/draw/nano-banana', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${apiKey}`
  },
  body: JSON.stringify({
    model: 'nano-banana-fast',
    prompt: enhancedPrompt,
    aspectRatio: 'auto',
    shutProgress: true
  })
});
```

#### 2. SSE æµå¼æ•°æ®è§£æ
```typescript
const parseSSEData = (text) => {
  const lines = text.split('\n');
  const events = [];
  
  for (const line of lines) {
    if (line.startsWith('data: ')) {
      const jsonStr = line.substring(6);
      if (jsonStr.trim()) {
        const data = JSON.parse(jsonStr);
        events.push(data);
      }
    }
  }
  
  return events;
};
```

#### 3. é”™è¯¯å¤„ç†å’Œå¤‡ç”¨æœåŠ¡
- è‡ªåŠ¨é™çº§åˆ° Stability AI
- å®Œå–„çš„é”™è¯¯æ—¥å¿—è®°å½•
- é‡è¯•æœºåˆ¶ï¼ˆå¦‚éœ€è¦ï¼‰

## ğŸ“Š æµ‹è¯•ç»“æœ

### åŠŸèƒ½æµ‹è¯•
- âœ… **æµå¼å“åº”**: 100% æˆåŠŸ
- âœ… **WebHook æ¨¡å¼**: 100% æˆåŠŸ  
- âœ… **ä¸åŒæ¨¡å‹**: 100% æˆåŠŸ
- âœ… **å›¾åƒç”Ÿæˆ**: 100% æˆåŠŸ

### æ€§èƒ½æŒ‡æ ‡
- **å¹³å‡å“åº”æ—¶é—´**: 5-10 ç§’
- **æˆåŠŸç‡**: 100%
- **å›¾åƒè´¨é‡**: é«˜è´¨é‡åŠ¨æ¼«æ‰‹åŠé£æ ¼
- **å›¾åƒæ ¼å¼**: PNG
- **å›¾åƒæœ‰æ•ˆæœŸ**: 2 å°æ—¶

## ğŸš€ éƒ¨ç½²çŠ¶æ€

### âœ… å·²å®Œæˆ
- [x] æ­£ç¡®çš„ API ç«¯ç‚¹é›†æˆ
- [x] SSE æµå¼æ•°æ®å¤„ç†
- [x] é”™è¯¯å¤„ç†æœºåˆ¶
- [x] å¤‡ç”¨æœåŠ¡é…ç½®
- [x] å®Œæ•´æµ‹è¯•éªŒè¯

### ğŸ“ æ›´æ–°çš„æ–‡ä»¶
1. `src/app/api/generate/image/route.ts` - ä¸»è¦ API å®ç°
2. `test-grsai-*.js` - å¤šä¸ªæµ‹è¯•è„šæœ¬
3. `GRSAI_*.md` - è¯¦ç»†æ–‡æ¡£æŠ¥å‘Š

## ğŸ’¡ ä½¿ç”¨æŒ‡å—

### 1. ç¯å¢ƒå˜é‡é…ç½®
```bash
GRSAI_API_KEY=sk-bd625bca604243989a7018a67614c889
GRSAI_USER_ID=1758354953
GRSAI_USERNAME=bnana
```

### 2. API è°ƒç”¨ç¤ºä¾‹
```javascript
const response = await fetch('/api/generate/image', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': 'Bearer your_api_key'
  },
  body: JSON.stringify({
    prompt: 'cute anime girl figure',
    service: 'grsai',
    options: {
      style: 'anime',
      pose: 'standing'
    }
  })
});
```

### 3. æ”¯æŒçš„å‚æ•°
- **model**: `nano-banana-fast` (æ¨è), `nano-banana`
- **aspectRatio**: `auto`, `1:1`, `16:9`, `9:16`, `4:3`, `3:4`, `3:2`, `2:3`, `5:4`, `4:5`, `21:9`
- **shutProgress**: `true` (ç›´æ¥è¿”å›ç»“æœ), `false` (æµå¼è¿›åº¦)

## ğŸ” æŠ€æœ¯ç»†èŠ‚

### API å“åº”æ ¼å¼
```json
{
  "id": "task-id",
  "results": [
    {
      "url": "https://file.grsai.com/file/image.png",
      "content": "Generated content description"
    }
  ],
  "progress": 100,
  "status": "succeeded",
  "failure_reason": "",
  "error": ""
}
```

### é”™è¯¯å¤„ç†
- **ç½‘ç»œé”™è¯¯**: è‡ªåŠ¨é‡è¯•
- **API é”™è¯¯**: é™çº§åˆ°å¤‡ç”¨æœåŠ¡
- **è§£æé”™è¯¯**: è¯¦ç»†æ—¥å¿—è®°å½•
- **è¶…æ—¶å¤„ç†**: åˆç†çš„è¶…æ—¶è®¾ç½®

## ğŸ“ˆ ç›‘æ§å»ºè®®

### å…³é”®æŒ‡æ ‡
1. **API è°ƒç”¨æˆåŠŸç‡**
2. **å›¾åƒç”ŸæˆæˆåŠŸç‡**
3. **å¹³å‡å“åº”æ—¶é—´**
4. **å›¾åƒ URL å¯è®¿é—®æ€§**

### å‘Šè­¦è®¾ç½®
- API æˆåŠŸç‡ < 90%: è­¦å‘Š
- å¹³å‡å“åº”æ—¶é—´ > 15ç§’: è­¦å‘Š
- è¿ç»­å¤±è´¥ > 5æ¬¡: ä¸¥é‡

## ğŸ¯ ä¼˜åŒ–å»ºè®®

### çŸ­æœŸä¼˜åŒ–
1. **ç¼“å­˜æœºåˆ¶**: ç¼“å­˜æˆåŠŸçš„å›¾åƒç”Ÿæˆç»“æœ
2. **æ‰¹é‡å¤„ç†**: æ”¯æŒæ‰¹é‡å›¾åƒç”Ÿæˆ
3. **è¿›åº¦æ˜¾ç¤º**: å®æ—¶æ˜¾ç¤ºç”Ÿæˆè¿›åº¦

### é•¿æœŸä¼˜åŒ–
1. **å¤šæ¨¡å‹æ”¯æŒ**: æ ¹æ®éœ€æ±‚é€‰æ‹©ä¸åŒæ¨¡å‹
2. **æˆæœ¬ä¼˜åŒ–**: ç›‘æ§ API ä½¿ç”¨æˆæœ¬
3. **è´¨é‡è¯„ä¼°**: è‡ªåŠ¨è¯„ä¼°ç”Ÿæˆå›¾åƒè´¨é‡

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜
1. **å›¾åƒ URL 404**: å›¾åƒå¯èƒ½å·²è¿‡æœŸï¼ˆ2å°æ—¶æœ‰æ•ˆæœŸï¼‰
2. **API è¶…æ—¶**: æ£€æŸ¥ç½‘ç»œè¿æ¥å’ŒæœåŠ¡å™¨çŠ¶æ€
3. **è§£æé”™è¯¯**: æ£€æŸ¥ SSE æ•°æ®æ ¼å¼

### è§£å†³æ–¹æ¡ˆ
1. **é‡æ–°ç”Ÿæˆ**: å¯¹äºè¿‡æœŸçš„å›¾åƒ URL
2. **é‡è¯•æœºåˆ¶**: å¯¹äºä¸´æ—¶ç½‘ç»œé—®é¢˜
3. **å¤‡ç”¨æœåŠ¡**: å½“ Grsai API ä¸å¯ç”¨æ—¶

## ğŸ‰ æ€»ç»“

Grsai API é›†æˆå·²å®Œå…¨æˆåŠŸï¼é¡¹ç›®ç°åœ¨å¯ä»¥ï¼š

âœ… **ç”Ÿæˆé«˜è´¨é‡çš„åŠ¨æ¼«æ‰‹åŠå›¾åƒ**
âœ… **æ”¯æŒå¤šç§å›¾åƒæ¯”ä¾‹å’Œé£æ ¼**
âœ… **æä¾›ç¨³å®šçš„ API æœåŠ¡**
âœ… **å…·å¤‡å®Œå–„çš„é”™è¯¯å¤„ç†**
âœ… **æ‹¥æœ‰å¤‡ç”¨æœåŠ¡ä¿éšœ**

**å»ºè®®ç«‹å³æŠ•å…¥ç”Ÿäº§ä½¿ç”¨ï¼** ğŸš€

---
*æŠ¥å‘Šç”Ÿæˆæ—¶é—´: 2025å¹´10æœˆ4æ—¥*
*é›†æˆçŠ¶æ€: å®Œæˆ âœ…*
*æµ‹è¯•çŠ¶æ€: é€šè¿‡ âœ…*
*ç”Ÿäº§å°±ç»ª: æ˜¯ âœ…*
